# consul Cookbook

> Consul is a Service Registration and Discovery tool.
> It forms the backend for storing the data about the node's IP, port and health of the application.
> Service is registered to Consul by using a simple JSON file where IP and Port number of the application is mentioned.
> Consul works with 'Client Server' architecture, where all the nodes are updated about the whole cluster state using gossip protocol.

## Example:

- Machine A: Consul Master[Load Balancer]
- Machine B: Consul Client[App Server 1]
- Machine C: Consul Client[App Server 2]

# Machine A:

``` sh
consul agent -server -bootstrap -node "ConsulMaster" -dc "GSL_Consul_Cluster" -data-dir /var/consul -config-dir /etc/consul.d -bind 172.27.59.224 -encrypt AwN9oEOELufO1iQGXZcPYQ==
```
- '-server -bootstrap' will start the Consul as a Server
- '-node' provides name to the Node
- '-dc' provides name to the Cluster which has to be same for all the connecting nodes in the cluster
- '-data-dir' path to the folder which will be used by Consul for gossiping[exchange of data]
- '-config-dir' path to the folder where configuration data for Consul is stored
- '-bind' is the bind address for the node which will be advertise

# Machine B:

``` sh
consul agent -data-dir /var/consul -client <IP of machine B> -ui-dir /root/consul -join <IP of machine A> -config-dir /etc/consul.d/client/ -encrypt AwN9oEOELufO1iQGXZcPYQ== -node "AppServerOne"
```
- '-client' denotes the IP of the machine to be advertise
- '-ui-dir' path for the UI for the Consul
- '- join' IP address for Consul Server
- '- encrypt' is the encryption key generated by using 'consul keygen'

# Machine C
``` sh
consul agent -data-dir /var/consul -client <IP of machine C> -ui-dir /root/consul -join <IP of machine A> -config-dir /etc/consul.d/client/ -encrypt AwN9oEOELufO1iQGXZcPYQ== -node "AppServerTwo"
```

> The above configuration creates a cluster of three machines where A is Consul Master and B and C are Consul Clients
